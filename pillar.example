# -*- coding: utf-8 -*-
# vim: ft=sls

### Zoomdata Pillar SLS example
#
zoomdata:
  ## Package installation settings
  #
  # Repository base URL where Zoomdata packages are hosted
  base_url: 'http://repo.zoomdata.com'
  # URL to the GnuPG public key for the repo/pkgs verification.
  # Put `none` or empty string to skip GnuPG check (for internal repos)
  gpgkey: 'https://repo.zoomdata.com/ZOOMDATA-GPG-KEY.pub'
  # Repository branch from which the packages would be installed
  release: '2.3'
  components:
    - stable
    - licensed
    - unstable

  # Exact version of Zoomdata Server packages to install, default is 'latest'
  {%- if grains['os'] == 'Ubuntu' %}
  # Ubuntu-specific version template: EDIT NUMBERS BEFORE dash ('-') sign
  #version: "2.3.10-1+{{ grains['oscodename'] }}.stable"
  {%- else %}
  #version: '2.3.10'
  {%- endif %}

  # Zoomdata Server packages to install
  packages:
    - zoomdata
    - zoomdata-scheduler
    - zoomdata-spark-proxy

  # Zoomdata EDC section
  edc:
    # Exact version of Zoomdata EDC packages to install, default is 'latest'
    {%- if grains['os'] == 'Ubuntu' %}
    # Ubuntu-specific version template: EDIT NUMBERS BEFORE dash ('-') sign
    #version: "2.3.6-1+{{ grains['oscodename'] }}.stable"
    {%- else %}
    #version: '2.3.6'
    {%- endif %}
    # Zoomdata EDC packages to install
    packages:
      - zoomdata-edc-elasticsearch-1.7
      - zoomdata-edc-rts

  ## Configuration settings
  #
  # Global system limits for Zoomdata user (per-service limits for systemd OS):
  # http://docs.zoomdata.com/installation-prerequisites
  limits:
    nproc:
      soft: '4096'
      hard: '4096'
    nofile:
      soft: '1048576'
      hard: '1048576'

  # Configuration property files and their corresponding variables:
  # http://docs.zoomdata.com/zoomdata-configuration-property-files-and-their-corresponding-variables
  environment:
    # Zoomdata Server
    zoomdata:
      path: '/etc/zoomdata/zoomdata.env'
      variables:
        JAVA_OPTS: '-Xss256k -Xms2048m -Xmx8192m'
    # Zoomdata Scheduler
    zoomdata-scheduler:
      path: '/etc/zoomdata/scheduler.env'
      variables:
        SCHEDULER_JAVA_OPTS: '-Xms512m -Xmx1024m'
    # Zoomdata SparkIT
    zoomdata-spark-proxy:
      path: '/etc/zoomdata/spark-proxy.env'
      variables:
        SPARK_PROXY_JAVA_OPTS: '-Xss256k -Xms512m -Xmx2048m'

  config:
    # Zoomdata Server
    zoomdata:
      path: '/etc/zoomdata/zoomdata.properties'
      properties:
        # Metadata DB connection details
        # (REMEMBER TO CHANGE VALUES BELOW IN `postgres` SECTION ACCORDINGLY!)
        spring.datasource.url: 'jdbc:postgresql://localhost:5432/zoomdata'
        spring.datasource.username: 'zoomdata'
        spring.datasource.password: 'Z00mda1a'
        # Screenshot Feature: disable it by default
        # http://docs.zoomdata.com/setting-up-screenshot-for-ubuntu
        screenshot.daemon.enabled: False
        screenshot.daemon.schedule.rate: '168h'  # 1 week
        screenshots.dashboards.enabled: False
        screenshots.datasource-charts.enabled: False
    # Zoomdata Scheduler
    zoomdata-scheduler:
      path: '/etc/zoomdata/scheduler.properties'
      properties:
        # Metadata DB connection details
        # (REMEMBER TO CHANGE VALUES BELOW IN `postgres` SECTION ACCORDINGLY!)
        spring.datasource.url: 'jdbc:postgresql://localhost:5432/zoomdata-scheduler'
        spring.datasource.username: 'zoomdata'
        spring.datasource.password: 'Z00mda1a'
    # Zoomdata SparkIT
    zoomdata-spark-proxy:
      path: '/etc/zoomdata/spark-proxy.properties'
      properties:
        hadoop.distro: 'cdh5'

  # Services to enable and start
  services:
    #- zoomdata
    #- zoomdata-edc-elasticsearch-1.7
    #- zoomdata-edc-rts
    #- zoomdata-scheduler
    #- zoomdata-spark-proxy


### PostgreSQL Pillar configuration
#
postgres:
  users:
    zoomdata:
      password: 'Z00mda1a'
  databases:
    zoomdata:
      owner: 'zoomdata'
    zoomdata-scheduler:
      owner: 'zoomdata'
