# -*- coding: utf-8 -*-

# Default variables for the Zoomdata LTS 4.9 release deployment

zoomdata:
  # Constants
  prefix: '/opt/zoomdata'
  config_dir: '/etc/zoomdata'
  user: zoomdata
  group: zoomdata

  # Defaults which could be overridden in Pillar
  base_url: 'http://repo.zoomdata.com'
  gpgkey: 'https://repo.zoomdata.com/ZOOMDATA-GPG-KEY.pub'
  release: '4.9'
  repositories:
    - tools
  components:
    - stable
    #- unstable

  bootstrap: False
  enforce: True
  erase: False

  #version: 'latest'
  packages:
    - zoomdata
    - zoomdata-query-engine
    #- zoomdata-admin-server
    #- zoomdata-config-server

  edc:
    #version: 'latest'
    packages:
      - zoomdata-edc-apache-solr
      - zoomdata-edc-cloudera-search
      - zoomdata-edc-elasticsearch-6.0
      - zoomdata-edc-elasticsearch-7.0
      - zoomdata-edc-hive
      - zoomdata-edc-impala
      - zoomdata-edc-memsql
      - zoomdata-edc-mongo
      - zoomdata-edc-mssql
      - zoomdata-edc-mysql
      - zoomdata-edc-oracle
      - zoomdata-edc-phoenix-4.7-queryserver
      - zoomdata-edc-postgresql
      - zoomdata-edc-redshift
      - zoomdata-edc-rts
      - zoomdata-edc-sparksql

    jdbc:
      drivers: {}
      install: False

    probe:
      timeout: Null
      path: 'actuator/health'

  microservices:
    #version: 'latest'
    packages:
      - zoomdata-consul
      - zoomdata-data-writer-postgresql
      - zoomdata-screenshot-service
      #- zoomdata-tracing-server

  tools:
    packages:
      - zoomdata-zdmanage

  # Comment added to each file modified by the formula
  header: |
    ################################################################################
    ### ATTENTION! WARNING! Managed by Salt (infrastructure automation software) ###
    ### PLEASE DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES MAY BE OVERWRITTEN! ###
    ################################################################################

  limits: {}

  environment: {}

  config:
    zoomdata:
      path: /etc/zoomdata/zoomdata.properties
      properties:
        spring.datasource.url: 'jdbc:postgresql://localhost:5432/zoomdata'
        spring.datasource.username: zoomdata
        spring.datasource.password: 'PleaseChangeMe'
        keyset.destination.params.jdbc_url: 'jdbc:postgresql://localhost:5432/zoomdata-keyset'
        keyset.destination.params.user_name: 'zoomdata'
        keyset.destination.params.password: 'PleaseChangeMe'
        keyset.destination.schema: 'public'
        upload.destination.params.jdbc_url: 'jdbc:postgresql://localhost:5432/zoomdata-upload'
        upload.destination.params.user_name: 'zoomdata'
        upload.destination.params.password: 'PleaseChangeMe'
        upload.destination.schema: 'public'
        upload.batch-size: 1000
        server.port: 8080
        server.servlet.context-path: /composer
      merge: True
      update: False
      discard: True
    zoomdata-consul:
      path: '/etc/zoomdata/consul.json'
      json: {}
    zoomdata-query-engine:
      path: '/etc/zoomdata/query-engine.properties'
      properties:
        spring.qe.datasource.jdbcUrl: 'jdbc:postgresql://localhost:5432/zoomdata-qe'
        spring.qe.datasource.username: 'zoomdata'
        spring.qe.datasource.password: 'PleaseChangeMe'
      merge: True
      update: False
      discard: True

  post_install: {}

  services:
    - zoomdata-consul
    - zoomdata-edc-apache-solr
    - zoomdata-edc-cloudera-search
    - zoomdata-edc-elasticsearch-6.0
    - zoomdata-edc-elasticsearch-7.0
    - zoomdata-edc-hive
    - zoomdata-edc-impala
    #- zoomdata-edc-memsql
    - zoomdata-edc-mongo
    #- zoomdata-edc-mssql
    #- zoomdata-edc-mysql
    #- zoomdata-edc-oracle
    - zoomdata-edc-phoenix-4.7-queryserver
    - zoomdata-edc-postgresql
    #- zoomdata-edc-redshift
    - zoomdata-edc-rts
    - zoomdata-edc-sparksql
    - zoomdata-data-writer-postgresql
    #- zoomdata-screenshot-service
    - zoomdata-query-engine
    - zoomdata

  setup:
    # This is supported starting from Zoomdata 4.0 release
    probe: 'api/version'
    timeout: 900
    # Zoomdata API V2 URI path without context path
    api: api
    # Zoomdata API V2 default headers
    headers:
      Accept: '*/*'
      Content-Type: 'application/vnd.zoomdata.v2+json'
    init:
      username: admin
      password: admin
    passwords: {}
    branding: {}
    connectors: {}
    license:
      URL: Null
      expirationDate: Null
      licenseType: 'TRIAL'
      userCount: '1'
      concurrentSessionCount: '1'
      enforcementLevel: 'PS'
      force: False
    toggles: {}

  backup:
    services: []
    databases: []
    state: Null
    destination: /opt/zoomdata/data/backups
    strptime: '%y-%m-%d_%H:%M:%S'
    retention: Null
    bin: pg_dump --no-password --clean --if-exists --create
    compressor: gzip
    comp_opts: ''
    comp_ext: '_postgre.sql.gz'

  restore:
    bin: psql
    user: postgres
    dir: Null
